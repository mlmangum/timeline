<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Resume</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --bg: #f4f7f6;
            --card-bg: #ffffff;
            --text: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            background-color: var(--bg);
            color: var(--text);
            overflow-x: hidden;
        }

        /* --- Header & Search --- */
        header {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .search-container {
            position: relative;
            width: 90%;
            max-width: 600px;
        }

        #active-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
            justify-content: center;
        }

        .tag-chip {
            background: var(--accent);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background 0.2s;
        }

        .tag-chip:hover { background: #2980b9; }
        .tag-chip span { margin-left: 8px; font-weight: bold; }

        input#search-bar {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s;
        }

        input#search-bar:focus { border-color: var(--accent); }

        #autocomplete-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 15px 15px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1001;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: none;
        }

        .autocomplete-item {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }

        .autocomplete-item:hover { background-color: #f0f0f0; }

        /* --- Timeline Container --- */
        #timeline-container {
            margin-top: 140px; 
            padding: 40px;
            display: flex;
            flex-direction: row; 
            overflow-x: auto;
            gap: 40px;
            min-height: 60vh;
            align-items: flex-start;
            scroll-behavior: smooth;
        }

        #timeline-container::-webkit-scrollbar { height: 8px; }
        #timeline-container::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }

        .timeline-card {
            background: var(--card-bg);
            min-width: 300px;
            max-width: 300px;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            flex-shrink: 0;
            border-top: 4px solid var(--accent);
        }

        .timeline-card:hover { transform: translateY(-5px); }
        
        .timeline-card.dimmed {
            opacity: 0.2;
            filter: grayscale(100%);
            pointer-events: none;
        }

        .card-year {
            font-size: 0.9rem;
            color: #888;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .card-org {
            font-size: 1rem;
            color: var(--accent);
            margin-bottom: 10px;
        }

        .card-summary {
            font-size: 0.95rem;
            line-height: 1.5;
            color: #555;
        }

        /* --- Modal (Expanded View) --- */
        #modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        #modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        #modal-close {
            position: absolute;
            top: 15px; right: 20px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #aaa;
        }

        #modal-image {
            width: 100%;
            height: auto;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .modal-link {
            display: inline-block;
            margin-top: 15px;
            padding: 10px 15px;
            background: var(--accent);
            color: white;
            text-decoration: none;
            border-radius: 5px;
        }

        /* --- Mobile Responsive (Vertical) --- */
        @media (max-width: 768px) {
            #timeline-container {
                flex-direction: column;
                overflow-x: hidden;
                align-items: center;
                gap: 20px;
                padding: 20px;
            }
            
            .timeline-card {
                min-width: 100%;
                max-width: 100%;
            }

            .search-container { width: 95%; }
        }
    </style>
</head>
<body>

    <header>
        <div class="search-container">
            <div id="active-tags"></div>
            <input type="text" id="search-bar" placeholder="Search by skill, role, or tool (e.g. 'Engineering')...">
            <div id="autocomplete-list"></div>
        </div>
    </header>

    <div id="timeline-container">
        <div style="margin: auto;">Loading data...</div>
    </div>

    <div id="modal-overlay">
        <div id="modal-content">
            <span id="modal-close">&times;</span>
            <h2 id="modal-title"></h2>
            <h4 id="modal-org" style="color:var(--accent)"></h4>
            <p id="modal-desc" style="line-height: 1.6; color: #444;"></p>
            <img id="modal-image" src="" alt="Project Image">
            <a id="modal-link" href="#" target="_blank" class="modal-link" style="display:none">View More</a>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQstd8i3GiklsRUUh9Y1QXmIYcxkZJ8e4nTOKn9KVIRmqOTKpPjJk4Ay_d_jgFbkHAPRuZoi9_oE2JM/pub?output=csv'; 
        const SHOW_DURATION = true; // Set to false to turn off duration calculation

        // --- STATE ---
        let allData = [];
        let allTags = new Set();
        let activeTags = [];

        // --- DOM ELEMENTS ---
        const timelineContainer = document.getElementById('timeline-container');
        const searchBar = document.getElementById('search-bar');
        const autocompleteList = document.getElementById('autocomplete-list');
        const activeTagsContainer = document.getElementById('active-tags');
        const modalOverlay = document.getElementById('modal-overlay');

        // --- INITIALIZATION ---
        function init() {
            Papa.parse(SHEET_CSV_URL, {
                download: true,
                header: true,
                complete: function(results) {
                    // Filter out empty rows
                    allData = results.data.filter(row => row.Title); 
                    
                    // Sort data chronologically (Newest First)
                    allData.sort((a, b) => {
                        const getMs = (y, m, d) => {
                            if (!y) return 0;
                            const dateStr = `${m || 'Jan'} ${d || '1'}, ${y}`;
                            const parsed = Date.parse(dateStr);
                            return isNaN(parsed) ? new Date(y, 0, 1).getTime() : parsed;
                        };
                        
                        const finishA = a['Finish Year'] ? getMs(a['Finish Year'], a['Finish Month'], a['Finish Day']) : Infinity;
                        const finishB = b['Finish Year'] ? getMs(b['Finish Year'], b['Finish Month'], b['Finish Day']) : Infinity;
                        
                        if (finishA !== finishB) return finishB - finishA;
                        return getMs(b['Start Year'], b['Start Month'], b['Start Day']) - getMs(a['Start Year'], a['Start Month'], a['Start Day']);
                    });

                    processTags();
                    renderTimeline();
                }
            });
        }

        // --- DATE FORMATTER & DURATION CALCULATOR ---
        function getMonthIndex(m) {
            if (!m) return 0; 
            const d = Date.parse(m + " 1, 2012");
            return isNaN(d) ? 0 : new Date(d).getMonth();
        }

        function calculateDuration(item) {
            if (!item['Start Year']) return '';
            
            const startY = parseInt(item['Start Year']);
            const startM = getMonthIndex(item['Start Month']);
            
            let finishY, finishM;
            if (!item['Finish Year']) {
                const now = new Date();
                finishY = now.getFullYear();
                finishM = now.getMonth();
            } else {
                finishY = parseInt(item['Finish Year']);
                finishM = getMonthIndex(item['Finish Month']);
            }
            
            let months = (finishY - startY) * 12 + (finishM - startM) + 1; 
            if (months < 1) months = 1;
            
            const yrs = Math.floor(months / 12);
            const mos = months % 12;
            
            let str = [];
            if (yrs > 0) str.push(`${yrs} yr${yrs > 1 ? 's' : ''}`);
            if (mos > 0 || yrs === 0) str.push(`${mos} mo${mos !== 1 ? 's' : ''}`);
            
            return ` &middot; ${str.join(' ')}`;
        }

        function formatTimelineDate(item) {
            function makeDateStr(y, m, d) {
                if (!y) return null;
                let str = '';
                if (m) {
                    str += m;
                    if (d) str += ' ' + d;
                    str += ', ';
                }
                str += y;
                return str;
            }

            const start = makeDateStr(item['Start Year'], item['Start Month'], item['Start Day']);
            const finish = makeDateStr(item['Finish Year'], item['Finish Month'], item['Finish Day']);

            if (!start) return ''; 

            let dateDisplay = '';
            if (!item['Finish Year']) {
                dateDisplay = `${start} – Present`;
            } else {
                dateDisplay = start === finish ? start : `${start} – ${finish}`;
            }

            if (SHOW_DURATION) {
                dateDisplay += `<span style="font-weight: normal; font-size: 0.9em; opacity: 0.75;">${calculateDuration(item)}</span>`;
            }

            return dateDisplay;
        }

        // --- DATA PROCESSING ---
        function processTags() {
            allData.forEach(item => {
                if (item.Tags) {
                    const tags = item.Tags.split(',').map(t => t.trim());
                    tags.forEach(t => allTags.add(t));
                }
            });
        }

        // --- RENDERING TIMELINE ---
        function renderTimeline() {
            timelineContainer.innerHTML = '';
            
            allData.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'timeline-card';
                card.dataset.index = index;
                
                const itemTags = item.Tags ? item.Tags.toLowerCase() : '';
                const matches = activeTags.length === 0 || activeTags.every(tag => itemTags.includes(tag.toLowerCase()));
                
                if (!matches) {
                    card.classList.add('dimmed');
                }

                const dateDisplay = formatTimelineDate(item);

                card.innerHTML = `
                    <div class="card-year">${dateDisplay}</div>
                    <div class="card-title">${item.Title}</div>
                    <div class="card-org">${item.Organization}</div>
                    <div class="card-summary">${item.Summary}</div>
                `;

                card.addEventListener('click', () => openModal(item));
                timelineContainer.appendChild(card);
            });
        }

        // --- SEARCH & TAGS ---
        searchBar.addEventListener('input', function() {
            const val = this.value.toLowerCase();
            autocompleteList.innerHTML = '';
            if (!val) {
                autocompleteList.style.display = 'none';
                return;
            }

            const matches = Array.from(allTags).filter(tag => 
                tag.toLowerCase().includes(val) && !activeTags.includes(tag)
            );

            if (matches.length > 0) {
                autocompleteList.style.display = 'block';
                matches.forEach(tag => {
                    const div = document.createElement('div');
                    div.className = 'autocomplete-item';
                    div.innerText = tag;
                    div.addEventListener('click', () => addTag(tag));
                    autocompleteList.appendChild(div);
                });
            } else {
                autocompleteList.style.display = 'none';
            }
        });

        searchBar.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const val = this.value;
                const match = Array.from(allTags).find(t => t.toLowerCase() === val.toLowerCase());
                if (match) addTag(match);
            }
        });

        function addTag(tag) {
            if (activeTags.includes(tag)) return;
            activeTags.push(tag);
            searchBar.value = '';
            autocompleteList.style.display = 'none';
            renderTags();
            renderTimeline();
        }

        function removeTag(tag) {
            activeTags = activeTags.filter(t => t !== tag);
            renderTags();
            renderTimeline();
        }

        function renderTags() {
            activeTagsContainer.innerHTML = '';
            activeTags.forEach(tag => {
                const chip = document.createElement('div');
                chip.className = 'tag-chip';
                chip.innerHTML = `${tag} <span>&times;</span>`;
                chip.addEventListener('click', () => removeTag(tag));
                activeTagsContainer.appendChild(chip);
            });
        }

        // --- MODAL ---
        function openModal(item) {
            document.getElementById('modal-title').innerText = item.Title;
            document.getElementById('modal-org').innerText = item.Organization;
            document.getElementById('modal-desc').innerText = item.Details || item.Summary;
            
            const img = document.getElementById('modal-image');
            if (item.ImageURL) {
                img.src = item.ImageURL;
                img.style.display = 'block';
            } else {
                img.style.display = 'none';
            }

            const link = document.getElementById('modal-link');
            if (item.Link) {
                link.href = item.Link;
                link.style.display = 'inline-block';
            } else {
                link.style.display = 'none';
            }

            modalOverlay.style.display = 'flex';
        }

        document.getElementById('modal-close').addEventListener('click', () => {
            modalOverlay.style.display = 'none';
        });

        modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) modalOverlay.style.display = 'none';
        });

        // Start
        init();
    </script>
</body>
</html>